<!DOCTYPE html>
<html lang="fr">
<head>
  <style>
.row-cols-simu {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
  gap: 30px;
  margin: 30px auto 0;
  max-width: 1000px;
  width: 100%;
}

.col-simu {
  flex: 1 1 30%;
  min-width: 280px;
  max-width: 33%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.bouton-simu {
  align-items: center;
  justify-content: center;
}

.bouton-simu button {
  margin-top: 40px;
}

.big-round-button {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: #4caf50;
  color: white;
  font-size: 30px;
  border: none;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
  transition: transform 0.2s ease-in-out;
}

.big-round-button:hover {
  transform: scale(1.1);
}

.colonne-droite input[type="number"] {
  max-width: 100px;
}
/* CENTRAGE ET MISE EN PAGE GLOBALE */
#tab-holding {
  display: flex;
  flex-direction: column;
  gap: 25px;
  background: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.05);
  max-width: 1200px;
  margin: auto;
}

/* TITRE CENTRÃ‰ ET AGRANDI */
#tab-holding h2 {
  font-size: 32px;
  text-align: center;
  margin-bottom: 20px;
}

/* GROUPE DE BLOCS BIENS + MONTANT RESTANT DÃ› */
.groupe-biens {
  display: flex;
  flex-wrap: wrap;
  gap: 25px;
  justify-content: center;
}

/* STYLE DE CHAQUE BLOC BIEN */
.bloc-biens {
  background: #f0f8ff;
  border: 1px solid #cce;
  padding: 10px 15px;
  border-radius: 8px;
  min-width: 220px;
  flex: 1 1 220px;
  max-width: 250px;
}

.bloc-biens h4 {
  margin: 0 0 10px;
  font-size: 16px;
  color: #2c3e50;
}

/* ZONE DES COLONNES INPUT */
.zone-inputs {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 20px;
  margin-top: 30px;
  flex-wrap: wrap;
}

.colonne-gauche, .colonne-droite {
  flex: 0 0 40%;
  max-width: 40%;
}

.colonne-gauche input,
.colonne-gauche select,
.colonne-droite input,
.colonne-droite select {
  width: 90%;
}

/* COLONNE BOUTON CENTRALE */
.colonne-bouton {
  flex: 0 0 20%;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* BOUTON SIMULER */
.btn-simuler {
  background: #4caf50;
  color: white;
  border: none;
  width: 80px;
  height: 80px;
  border-radius: 50%;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  transition: background 0.3s ease;
}

.centered {
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  flex-direction: column;
  margin-top: 20px;
}
/* Nouveau style aÃ©rÃ© et responsive */
#tab-holding {
  display: flex;
  flex-direction: column;
  gap: 25px;
  background: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.05);
  max-width: 1000px;
  margin: auto;
}

.groupe-biens {
  display: flex;
  flex-wrap: wrap;
  gap: 25px;
}

.bloc-biens {
  background: #f0f8ff;
  border: 1px solid #cce;
  padding: 10px 15px;
  border-radius: 8px;
  min-width: 230px;
}

.bloc-biens h4 {
  margin: 0 0 10px;
  font-size: 16px;
  color: #2c3e50;
}

.bloc-biens label {
  display: block;
  margin-bottom: 5px;
}

.input-paires {
  display: flex;
  flex-wrap: wrap;
  gap: 25px;
}

.input-paires > div {
  flex: 1 1 45%;
  min-width: 250px;
}

input[type="number"], select {
  width: 100%;
  padding: 6px 10px;
  font-size: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  font-size: 18px;
  padding: 12px 25px;
  border-radius: 10px;
  margin-top: 10px;
  cursor: pointer;
}
</style>
</head>
<body>
<div id="tab-holding">
  <h2>ğŸ©ï¸ HOLDING / SCI</h2>
<div style="text-align: center; margin-bottom: 40px;">
  <a href="index.html">
    <button style="margin-top: 10px; background-color: #2c7a7b; color: white; border: none; padding: 8px 16px; font-size: 16px; border-radius: 8px; cursor: pointer;">ğŸ  Retour accueil</button>
  </a>
</div>

  <div class="groupe-biens">
  <div class="bloc-biens">
    <h4>Ferry</h4>
    <label><input type="checkbox" class="bien-checkbox" value="Ferry 1"> Ferry 1</label>
    <label><input type="checkbox" class="bien-checkbox" value="Ferry 2"> Ferry 2</label>
  </div>
  <div class="bloc-biens">
    <h4>Ã‰glise</h4>
    <label><input type="checkbox" class="bien-checkbox" value="Eglise T3"> Ã‰glise T3</label>
    <label><input type="checkbox" class="bien-checkbox" value="Eglise Studio"> Ã‰glise Studio</label>
  </div>
  <div class="bloc-biens">
    <h4>Phoenix</h4>
    <label><input type="checkbox" class="bien-checkbox" value="Phoenix 1"> Phoenix 1</label>
    <label><input type="checkbox" class="bien-checkbox" value="Phoenix 2"> Phoenix 2</label>
    <label><input type="checkbox" class="bien-checkbox" value="Phoenix 3"> Phoenix 3</label>
  </div>
<div class="bloc-biens" style="order: 4;">
  <h4>ğŸ’¶ Montant dÃ»</h4>
  <label for="montant-restant-du">Montant restant dÃ» Total (modifiable)</label>
  <input type="number" id="montant-restant-du" value="0" style="width: 80%;">
</div>
  <div class="bloc-biens">
    <h4>Individuels</h4>
    <label><input type="checkbox" class="bien-checkbox" value="Berard"> Berard</label>
    <label><input type="checkbox" class="bien-checkbox" value="Acquises"> Acquises</label>
    <label><input type="checkbox" class="bien-checkbox" value="Sorlin"> Sorlin</label>
  </div>
  <div class="bloc-biens">
    <h4>Actions groupÃ©es</h4>
    <label><input type="checkbox" id="all-biens"> <strong>âœ… Tous les biens</strong></label>
  </div>
</div>

<!-- ğŸ”„ Remplace ton bloc actuel input-paires par ceci -->
<!-- Bloc 3 colonnes fixes alignÃ©es -->
<div class="row-cols-simu">
  <div class="col-simu">
    <label><strong>AnnÃ©e de revente</strong></label>
    <input type="number" id="annee-revente-auto" value="2032" min="2023" max="2057" onchange="updateMontantRestantAnnuel()">

    <label><strong>Valeur de revente (en â‚¬)</strong></label>
    <input type="number" id="valeur-revente" value="400000" step="10000">

    <label><strong>Plus-Value Ã  Payer</strong>
      <a href="simulateur_plusvalue.html" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/128/5974/5974636.png" alt="calculatrice" style="width:20px; vertical-align:middle; margin-left:5px;">
      </a>
    </label>
    <input type="number" id="plus-value" placeholder="Ã€ remplir via simulateur PV">
  </div>

  <div class="col-simu bouton-simu">
    <button onclick="calculerSimulationHolding()" class="big-round-button">ğŸ”</button>
  </div>

  <div class="col-simu">
    <label><strong>Type de donation</strong></label>
    <select id="donation-type">
      <option value="aucune">Aucune</option>
      <option value="fractionnee">FractionnÃ©e (100kâ‚¬/15 ans/enfant)</option>
      <option value="nue-propriete">Nue-propriÃ©tÃ© avec usufruit conservÃ©</option>
    </select>

    <label><strong>Ã‚ge JÃ©rÃ´me</strong></label>
    <input type="number" id="age-donateur" value="53" readonly style="max-width: 80px;"> 

    <label><strong>Ã‚ge AngÃ©lique</strong></label>
    <input type="number" id="age-angelique" value="52" readonly style="max-width: 80px;">
  </div>
</div>

<div class="centered" style="margin-top: 30px;">
  <details style="max-width: 800px; width: 100%; text-align: left;">
    <summary style="cursor: pointer; font-weight: bold; color: #d84315; font-size: 18px; text-align: center;">
      ğŸ“˜ En savoir plus sur les donations
    </summary>
    <div style="padding: 15px; background: #fff3e0; border-radius: 8px; margin-top: 10px;">
      <h4>ğŸ Donation fractionnÃ©e</h4>
    <p>Tu peux donner <strong>100 000 â‚¬</strong> Ã  chacun de tes enfants tous les <strong>15 ans</strong> sans payer dâ€™impÃ´ts. Si tu as 3 enfants, tu peux leur transmettre jusquâ€™Ã  <strong>300 000 â‚¬</strong> sans frais, Ã  condition de respecter cet intervalle.</p>
    <p><strong>Exemple :</strong> JÃ©rÃ´me et AngÃ©lique veulent transmettre 270 000 â‚¬. Ils donnent 90 000 â‚¬ Ã  <strong>Tina</strong> (nÃ©e en 2003), <strong>Enzo</strong> (nÃ© en 2004) et <strong>Samuel</strong> (nÃ© en 2011). Comme aucune donation nâ€™a Ã©tÃ© faite depuis 15 ans, tout est exonÃ©rÃ©.</p>
    <p><em>Astuce :</em> refaire une vague en 2040 permettrait de transmettre encore sans frais.</p>

    <h4>ğŸ  Donation en nue-propriÃ©tÃ© avec usufruit conservÃ©</h4>
    <p>Tu donnes le bien Ã  tes enfants, mais tu gardes les loyers pour toi. Câ€™est un bon moyen de prÃ©parer lâ€™avenir tout en conservant un revenu.</p>
    <p><strong>Exemple :</strong> En 2036, JÃ©rÃ´me (57 ans) donne un appart de 200 000 â‚¬ Ã  Samuel. Lâ€™Ã‰tat estime quâ€™il donne seulement 120 000 â‚¬ (60 %) car il garde lâ€™usufruit. Samuel rÃ©cupÃ©rera la pleine propriÃ©tÃ© au dÃ©cÃ¨s de JÃ©rÃ´me.</p>
    <p><em>RÃ©sultat :</em> Moins de droits Ã  payer maintenant, mais transmission dÃ©jÃ  faite.</p>
  </div>
</details>
  </div>
 
<div id="resultats-holding" style="margin-top: 30px; padding: 20px; background: #f1f8e9; border-radius: 10px; display: none; width: 100%; max-width: 700px;">
    <div id="resultats-holding-content"></div>
    <div id="bloc-conseil-donation" style="margin-top: 30px; padding: 15px; border: 2px solid #e0e0e0; background: #fffde7; border-radius: 8px; font-size: 15px;"></div>
  </div>
</div>


 <!-- ğŸ§  Conseil donation personnalisÃ© injectÃ© dynamiquement -->
<div id="bloc-conseil-donation"
     style="margin-top: 30px; padding: 15px; border: 2px solid #e0e0e0; background: #fffde7; border-radius: 8px; font-size: 15px;">
</div>
<div id="resultats-holding" style="margin-top: 20px; padding: 20px; background: #f1f8e9; border-radius: 10px; display: none;"></div>
  </div>
</div>
<div class="centered">
  <div>
    <button type="button" onclick="saveHoldingSimu()" style="background:#ff9800; color:white; border:none; padding:12px 25px; border-radius:8px; margin:10px; font-size:16px; cursor:pointer;">ğŸ’¾ Sauvegarder</button>
    <button type="button" onclick="loadHoldingSimu()" style="background:#fb8c00; color:white; border:none; padding:12px 25px; border-radius:8px; margin:10px; font-size:16px; cursor:pointer;">ğŸ”„ Restaurer</button>
    <button type="button" onclick="exportHoldingSimu()" style="background:#ef6c00; color:white; border:none; padding:12px 25px; border-radius:8px; margin:10px; font-size:16px; cursor:pointer;">ğŸ“¤ Export JSON</button>
    <label for="import-json" style="background:#d84315; color:white; padding:12px 25px; border-radius:8px; margin:10px; font-size:16px; cursor:pointer; display:inline-block;">
      ğŸ“¥ Import JSON
      <input type="file" id="import-json" onchange="importHoldingSimu(event)" accept="application/json" style="display:none;">
    </label>
  </div>
</div>

<script>
const restantAnnuelParBien = {
  "Ferry 1": {"2023": 73306, "2024": 71803, "2025": 70286, "2026": 68756, "2027": 67212, "2028": 65650, "2029": 64072, "2030": 62475, "2031": 60858, "2032": 59220, "2033": 57559, "2034": 55874, "2035": 54164, "2036": 52428, "2037": 50663, "2038": 48868, "2039": 47043, "2040": 45188, "2041": 43302, "2042": 41384, "2043": 39435, "2044": 37453, "2045": 35438, "2046": 33388, "2047": 31304, "2048": 29185, "2049": 27029, "2050": 24837, "2051": 22605, "2052": 20335, "2053": 18024, "2054": 15672, "2055": 13277, "2056": 10839, "2057": 8366},
  "Ferry 2": {"2023": 79327, "2024": 77699, "2025": 76059, "2026": 74403, "2027": 72731, "2028": 71042, "2029": 69334, "2030": 67606, "2031": 65856, "2032": 64083, "2033": 62286, "2034": 60463, "2035": 58613, "2036": 56733, "2037": 54824, "2038": 52882, "2039": 50907, "2040": 48899, "2041": 46858, "2042": 44783, "2043": 42674, "2044": 40529, "2045": 38348, "2046": 36130, "2047": 33875, "2048": 31582, "2049": 29249, "2050": 26876, "2051": 24462, "2052": 22005, "2053": 19505, "2054": 16959, "2055": 14368, "2056": 11729, "2057": 9053},
  "Berard": {"2023": 62095, "2024": 60670, "2025": 59233, "2026": 57783, "2027": 56319, "2028": 54840, "2029": 53347, "2030": 51837, "2031": 50310, "2032": 48765, "2033": 47202, "2034": 45619, "2035": 44017, "2036": 42394, "2037": 40750, "2038": 39083, "2039": 37394, "2040": 35681, "2041": 33943, "2042": 32180, "2043": 30391, "2044": 28574, "2045": 26730, "2046": 24856, "2047": 22952, "2048": 21018, "2049": 19052, "2050": 17053, "2051": 15020, "2052": 12953, "2053": 10850, "2054": 8711, "2055": 6533, "2056": 4320, "2057": 2070},
  "Eglise T3": {"2023": 64563, "2024": 62959, "2025": 61342, "2026": 59711, "2027": 58065, "2028": 56403, "2029": 54724, "2030": 53027, "2031": 51311, "2032": 49575, "2033": 47818, "2034": 46039, "2035": 44237, "2036": 42411, "2037": 40561, "2038": 38685, "2039": 36783, "2040": 34853, "2041": 32896, "2042": 30909, "2043": 28893, "2044": 26846, "2045": 24768, "2046": 22658, "2047": 20515, "2048": 18339, "2049": 16128, "2050": 13882, "2051": 11600, "2052": 9280, "2053": 6922, "2054": 4530, "2055": 2103, "2056": 0, "2057": 0},
  "Eglise Studio": {"2023": 36311, "2024": 35402, "2025": 34478, "2026": 33539, "2027": 32584, "2028": 31613, "2029": 30625, "2030": 29620, "2031": 28597, "2032": 27555, "2033": 26494, "2034": 25413, "2035": 24311, "2036": 23188, "2037": 22042, "2038": 20875, "2039": 19684, "2040": 18469, "2041": 17230, "2042": 15966, "2043": 14676, "2044": 13361, "2045": 12018, "2046": 10648, "2047": 9250, "2048": 7824, "2049": 6370, "2050": 4886, "2051": 3372, "2052": 1828, "2053": 252, "2054": 0, "2055": 0, "2056": 0, "2057": 0},
  "Sorlin": {"2023": 28971, "2024": 28189, "2025": 27393, "2026": 26582, "2027": 25755, "2028": 24912, "2029": 24051, "2030": 23172, "2031": 22274, "2032": 21357, "2033": 20420, "2034": 19462, "2035": 18483, "2036": 17482, "2037": 16459, "2038": 15413, "2039": 14344, "2040": 13251, "2041": 12134, "2042": 10991, "2043": 9822, "2044": 8626, "2045": 7402, "2046": 6150, "2047": 4868, "2048": 3556, "2049": 2213, "2050": 839, "2051": 0, "2052": 0, "2053": 0, "2054": 0, "2055": 0, "2056": 0, "2057": 0},
  "Acquises": {"2023": 17128, "2024": 16725, "2025": 16315, "2026": 15897, "2027": 15470, "2028": 15034, "2029": 14588, "2030": 14133, "2031": 13668, "2032": 13192, "2033": 12706, "2034": 12209, "2035": 11701, "2036": 11182, "2037": 10651, "2038": 10108, "2039": 9543, "2040": 8966, "2041": 8376, "2042": 7773, "2043": 7156, "2044": 6525, "2045": 5880, "2046": 5219, "2047": 4543, "2048": 3850, "2049": 3140, "2050": 2413, "2051": 1667, "2052": 902, "2053": 117, "2054": 0, "2055": 0, "2056": 0, "2057": 0},
  "Phoenix 1": {"2023": 43603,"2024": 43268,"2025": 41408,"2026": 39275,"2027": 37088,"2028": 34845,"2029": 32544,"2030": 30181,"2031": 27756,"2032": 25264,"2033": 22704,"2034": 20071,"2035": 17363,"2036": 14576,"2037": 11707,"2038": 8753,"2039": 6070,"2040": 3346,"2041": 581,"2042": 0},
  "Phoenix 2": {"2023": 55825.0, "2024": 55397.0, "2025": 53015.0, "2026": 50284.0, "2027": 47484.0, "2028": 44613.0, "2029": 41666.0, "2030": 38642.0, "2031": 35536.0, "2032": 32346.0, "2033": 29068.0, "2034": 25697.0, "2035": 22230.0, "2036": 18662.0, "2037": 14988.0, "2038": 11207.0, "2039": 7771.0, "2040": 4284.0, "2041": 744.0, "2042": 0.0},
  "Phoenix 3": {"2023": 42573.0, "2024": 42246.0, "2025": 40430.0, "2026": 38347.0, "2027": 36212.0, "2028": 34022.0, "2029": 31775.0, "2030": 29468.0, "2031": 27100.0, "2032": 24667.0, "2033": 22167.0, "2034": 19597.0, "2035": 16953.0, "2036": 14232.0, "2037": 11430.0, "2038": 8547.0, "2039": 5926.0, "2040": 3267.0, "2041": 567.0, "2042": 0.0}
};

function updateMontantRestantAnnuel() {
  const annee = document.getElementById('annee-revente-auto').value;
  const biens = Array.from(document.querySelectorAll('.bien-checkbox'))
    .filter(cb => cb.checked)
    .map(cb => cb.value);
  let total = 0;
  biens.forEach(bien => {
    const montant = (restantAnnuelParBien[bien] && restantAnnuelParBien[bien][annee]) || 0;
    total += montant;
  });
  document.getElementById('montant-restant-du').value = Math.round(total);
}

document.querySelectorAll('.bien-checkbox').forEach(cb =>
  cb.addEventListener('change', updateMontantRestantAnnuel)
);
  // Met Ã  jour automatiquement l'Ã¢ge Ã  partir de l'annÃ©e de revente
  document.getElementById('annee-revente-auto').addEventListener('change', () => {
    const annee = parseInt(document.getElementById('annee-revente-auto').value);
    const ageJerome = annee - 1979;
const ageAngelique = annee - 1980;
document.getElementById('age-donateur').value = ageJerome;
document.getElementById('age-angelique').value = ageAngelique;
  });

  document.getElementById('all-biens').addEventListener('change', function () {
  const checkboxes = document.querySelectorAll('.bien-checkbox');
  checkboxes.forEach(cb => cb.checked = this.checked);
  updateMontantRestantAnnuel();
});

  function saveHoldingSimu() {
  const data = {
    biens: Array.from(document.querySelectorAll('.bien-checkbox')).filter(cb => cb.checked).map(cb => cb.value),
    anneeRevente: document.getElementById('annee-revente-auto').value,
    montantRestantDu: document.getElementById('montant-restant-du').value,
    valeurRevente: document.getElementById('valeur-revente').value,
       plusvalue: document.getElementById('plus-value').value,
    donation: document.getElementById('donation-type').value,
    age: document.getElementById('age-donateur').value
  };
  localStorage.setItem('simuHolding', JSON.stringify(data));
  alert("âœ… Simulation sauvegardÃ©e avec succÃ¨s !");
  }

  function loadHoldingSimu() {
  const data = JSON.parse(localStorage.getItem('simuHolding') || '{}');
  if (!data || !data.biens) {
    alert("âš ï¸ Aucune sauvegarde trouvÃ©e.");
    return;
  }
  document.querySelectorAll('.bien-checkbox').forEach(cb => cb.checked = data.biens?.includes(cb.value));
  document.getElementById('annee-revente-auto').value = data.anneeRevente || 2032;
  document.getElementById('montant-restant-du').value = data.montantRestantDu || 0;
  document.getElementById('valeur-revente').value = data.valeurRevente || 400000;
    document.getElementById('plus-value').value = data.plusvalue || '';
  document.getElementById('donation-type').value = data.donation || 'aucune';
  const age = data.age || (parseInt(data.anneeRevente || 2032) - 1979);
  document.getElementById('age-donateur').value = age;
  updateMontantRestantAnnuel();
  alert("âœ… Simulation chargÃ©e avec succÃ¨s !");
  }

  function exportHoldingSimu() {
    const data = localStorage.getItem('simuHolding');
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'simulation_holding.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  function importHoldingSimu(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      localStorage.setItem('simuHolding', e.target.result);
      loadHoldingSimu();
    };
    reader.readAsText(file);
  }
function calculerSimulationHolding() {
  const biens = Array.from(document.querySelectorAll('.bien-checkbox'))
    .filter(cb => cb.checked)
    .map(cb => cb.value);

  const montantRestant = parseFloat(document.getElementById('montant-restant-du').value);
  const valeurRevente = parseFloat(document.getElementById('valeur-revente').value);
  const plusValue = parseFloat(document.getElementById('plus-value').value) || 0;
  const donationType = document.getElementById('donation-type').value;
  const age = parseInt(document.getElementById('age-donateur').value);

  // Nouveau calcul sans IR/SSI : on dÃ©duit directement la plus-value entrÃ©e
  let cashReel = valeurRevente - montantRestant;
  let cashApresFisc = cashReel - plusValue;

  // Donation (facultatif)
  let donationImpact = '';
  if (donationType === 'fractionnee') {
    donationImpact = 'Optimisation par tranches de 100kâ‚¬/enfant tous les 15 ans (si respectÃ©e).';
  } else if (donationType === 'nue-propriete') {
    let coef = age <= 70 ? 0.6 : (age <= 80 ? 0.7 : 0.8);
    cashApresFisc *= coef;
    donationImpact = `Diminution fiscale via nue-propriÃ©tÃ© (~${Math.round(coef * 100)}% transmis, 100% usufruit conservÃ©)`;
  } else {
    donationImpact = 'Pas dâ€™effet fiscal particulier liÃ© Ã  la donation.';
  }

  const html = `
    <h3>ğŸ“Š RÃ©sultats de la simulation</h3>
    <ul>
      <li>Biens sÃ©lectionnÃ©s : <strong>${biens.join(', ')}</strong></li>
      <li>Montant restant dÃ» : <strong>${montantRestant.toLocaleString()} â‚¬</strong></li>
      <li>Valeur de revente : <strong>${valeurRevente.toLocaleString()} â‚¬</strong></li>
      <li>Plus-value Ã  dÃ©duire (dÃ©jÃ  calculÃ©e) : <strong>${plusValue.toLocaleString()} â‚¬</strong></li>
      <li>ğŸ’¶ Cash net rÃ©cupÃ©rable aprÃ¨s plus-value : <strong>${Math.round(cashApresFisc).toLocaleString()} â‚¬</strong></li>
      <li>ğŸ Donation : <em>${donationImpact}</em></li>
    </ul>
  `;

    const bloc = document.getElementById('resultats-holding');
  const content = document.getElementById('resultats-holding-content');
  content.innerHTML = html;
  bloc.style.display = 'block';

  // INJECTION DU CONSEIL APRÃˆS RÃ‰SULTAT
  injecterConseilDonationPersonnalise();
}
function genererBlocDonationPersonnalise(anneeRevente, valeurRevente, donationType) {
  const enfants = [
    { nom: "Tina", anneeNaissance: 2003, lienJerome: false, lienAngelique: true },
    { nom: "Enzo", anneeNaissance: 2004, lienJerome: true, lienAngelique: false },
    { nom: "Samuel", anneeNaissance: 2011, lienJerome: true, lienAngelique: true }
  ];

  const jeromeAge = anneeRevente - 1979;
  const angeliqueAge = anneeRevente - 1980;
  const valeurParParent = valeurRevente / 2;

  const ageTina = anneeRevente - 2003;
  const ageEnzo = anneeRevente - 2004;
  const ageSamuel = anneeRevente - 2011;

  let html = "";

  if (donationType === "fractionnee") {
    html += `<h3>ğŸŸ¢ Donation fractionnÃ©e â€“ Simulation personnalisÃ©e (${anneeRevente})</h3>`;
    html += `<p>En ${anneeRevente} :</p>`;
    html += `<ul>
      <li>JÃ©rÃ´me a <strong>${jeromeAge} ans</strong>, AngÃ©lique <strong>${angeliqueAge} ans</strong></li>
      <li>Les enfants ont : Tina (<strong>${ageTina} ans</strong>), Enzo (<strong>${ageEnzo} ans</strong>), Samuel (<strong>${ageSamuel} ans</strong>)</li>
    </ul>`;
    html += `<p>Tu veux transmettre <strong>${valeurRevente.toLocaleString()} â‚¬</strong> (valeur revente).<br>
      Chaque parent peut donner sa part (50%) soit <strong>${valeurParParent.toLocaleString()} â‚¬</strong>.</p>`;

    html += `<table border="1" cellpadding="6" style="border-collapse: collapse; margin-bottom: 15px;">
      <thead style="background:#eee;">
        <tr>
          <th>Donateur</th><th>Ã€ qui</th><th>Lien</th><th>Plafond</th><th>Peut donner</th>
        </tr>
      </thead><tbody>`;

    enfants.forEach(enf => {
      html += `<tr><td>JÃ©rÃ´me</td><td>${enf.nom}</td><td>${enf.lienJerome ? "Fils" : "Aucun"}</td><td>${enf.lienJerome ? "100â€¯000 â‚¬" : "0 â‚¬"}</td><td>${enf.lienJerome ? "âœ…" : "âŒ"}</td></tr>`;
      html += `<tr><td>AngÃ©lique</td><td>${enf.nom}</td><td>${enf.lienAngelique ? "Fille" : "Aucun"}</td><td>${enf.lienAngelique ? "100â€¯000 â‚¬" : "0 â‚¬"}</td><td>${enf.lienAngelique ? "âœ…" : "âŒ"}</td></tr>`;
    });

    html += `</tbody></table>`;

    html += `<p>âœ… Tu peux rÃ©partir :</p>
    <ul>
      <li>100â€¯000 â‚¬ Ã  Enzo (via JÃ©rÃ´me)</li>
      <li>100â€¯000 â‚¬ Ã  Tina (via AngÃ©lique)</li>
      <li>100â€¯000 â‚¬ Ã  Samuel (50k de chacun)</li>
    </ul>
    <p>ğŸ’¡ Astuce : tu pourras <strong>refaire une vague en ${anneeRevente + 15}</strong>, et transmettre Ã  nouveau <strong>300â€¯000 â‚¬ exonÃ©rÃ©s</strong>.</p>`;
  }

  if (donationType === "nue-propriete") {
    let coef = jeromeAge <= 50 ? 0.5 : (jeromeAge <= 60 ? 0.6 : (jeromeAge <= 70 ? 0.7 : 0.8));
    let baseFiscale = Math.round(valeurRevente * coef);

    html += `<h3>ğŸŸ£ Nue-propriÃ©tÃ© avec usufruit conservÃ© â€“ Simulation personnalisÃ©e (${anneeRevente})</h3>`;
    html += `<p>En ${anneeRevente}, JÃ©rÃ´me a <strong>${jeromeAge} ans</strong> â†’ dÃ©cote fiscale : <strong>${Math.round(coef * 100)} %</strong></p>`;
    html += `<p>Si tu donnes <strong>${valeurRevente.toLocaleString()} â‚¬</strong>, lâ€™administration considÃ¨re que tu transmets seulement <strong>${baseFiscale.toLocaleString()} â‚¬</strong> fiscalement (valeur nue-propriÃ©tÃ©).</p>`;
    html += `<ul>
      <li>ğŸ  Tu gardes <strong>100 % des loyers</strong></li>
      <li>ğŸ§¾ Ã€ ton dÃ©cÃ¨s, les enfants rÃ©cupÃ¨rent <strong>la pleine propriÃ©tÃ© sans fiscalitÃ© supplÃ©mentaire</strong></li>
    </ul>`;
  }

  return html;
}

function injecterConseilDonationPersonnalise() {
  const donation = document.getElementById("donation-type").value;
  const annee = parseInt(document.getElementById("annee-revente-auto").value);
  const valeur = parseInt(document.getElementById("valeur-revente").value);
  const bloc = document.getElementById("bloc-conseil-donation");

  bloc.innerHTML = (donation === "aucune")
    ? "<em>Pas de stratÃ©gie de donation sÃ©lectionnÃ©e.</em>"
    : genererBlocDonationPersonnalise(annee, valeur, donation);
}
</script>
</body>
</html>

